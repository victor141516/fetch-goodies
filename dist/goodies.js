function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{Promise.resolve(value).then(_next,_throw)}}function _async_to_generator(fn){return function(){var self=this,args=arguments;return new Promise(function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(undefined)})}}function _define_property(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function _object_spread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};var ownKeys=Object.keys(source);if(typeof Object.getOwnPropertySymbols==="function"){ownKeys=ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function(sym){return Object.getOwnPropertyDescriptor(source,sym).enumerable}))}ownKeys.forEach(function(key){_define_property(target,key,source[key])})}return target}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly){symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable})}keys.push.apply(keys,symbols)}return keys}function _object_spread_props(target,source){source=source!=null?source:{};if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source))}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))})}return target}function _type_of(obj){"@swc/helpers - typeof";return obj&&typeof Symbol!=="undefined"&&obj.constructor===Symbol?"symbol":typeof obj}function _ts_generator(thisArg,body){var f,y,t,g,_={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),"throw":verb(1),"return":verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break}if(t[2])_.ops.pop();_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e];y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true}}}function _ts_values(o){var s=typeof Symbol==="function"&&Symbol.iterator,m=s&&o[s],i=0;if(m)return m.call(o);if(o&&typeof o.length==="number")return{next:function(){if(o&&i>=o.length)o=void 0;return{value:o&&o[i++],done:!o}}};throw new TypeError(s?"Object is not iterable.":"Symbol.iterator is not defined.")}import{HttpStatusCodeConsideredError,NoMoreRetriesError,RetryConditionNotMetError,UrlPrefixNotSupportedError}from"./errors";var DEFAULT_RETRY_COUNT=3;var DEFAULT_RETRY_DELAY=1e3;var DEFAULT_RETRY_ON=function(){return true};var DEFAULT_HTTP_CODES_CONSIDERED_SUCCESSFUL=function(statusCode){return statusCode>=200&&statusCode<300};export var goodies=function(fetchFunction){var _ref=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},urlPrefix=_ref.urlPrefix,_ref_httpCodesConsideredSuccessful=_ref.httpCodesConsideredSuccessful,httpCodesConsideredSuccessful=_ref_httpCodesConsideredSuccessful===void 0?DEFAULT_HTTP_CODES_CONSIDERED_SUCCESSFUL:_ref_httpCodesConsideredSuccessful,tmp=_ref.retry,_ref1=tmp===void 0?{}:tmp,_ref_count=_ref1.count,count=_ref_count===void 0?DEFAULT_RETRY_COUNT:_ref_count,_ref_delay=_ref1.delay,delay=_ref_delay===void 0?DEFAULT_RETRY_DELAY:_ref_delay,_ref_forceParseJson=_ref.forceParseJson,forceParseJson=_ref_forceParseJson===void 0?false:_ref_forceParseJson;var fetchWithGoodies=function(){var _ref=_async_to_generator(function(input){var _loop,options,_response_headers_get,optionsCopy,_optionsCopy,_optionsCopy1,_method,_headers,retry,_optionsCopy_retry_count,_optionsCopy_retry_delay,_optionsCopy_retry_on,response,isNewResponse,_ret,textResponse,responseCopy,jsonResponse;var _arguments=arguments;return _ts_generator(this,function(_state){switch(_state.label){case 0:_loop=function(){var isHttpStatusCodeConsideredError,error,message,delay;return _ts_generator(this,function(_state){switch(_state.label){case 0:_state.trys.push([0,2,,4]);isNewResponse=false;return[4,fetchFunction(input,optionsCopy)];case 1:response=_state.sent();isNewResponse=true;isHttpStatusCodeConsideredError=false;if(Array.isArray(httpCodesConsideredSuccessful)){if(!httpCodesConsideredSuccessful.includes(response.status)){isHttpStatusCodeConsideredError=true}}else if(!httpCodesConsideredSuccessful(response.status)){isHttpStatusCodeConsideredError=true}if(isHttpStatusCodeConsideredError){throw new HttpStatusCodeConsideredError}return[2,"break"];case 2:error=_state.sent();retry.count--;message=error&&(typeof error==="undefined"?"undefined":_type_of(error))==="object"&&"message"in error&&typeof error.message==="string"?error.message:"Unknown error";if(retry.count===0){throw new NoMoreRetriesError("No more retries: "+message)}if(!retry.on({response:isNewResponse?response:null,error:error,retryCount:retry.count})){throw new RetryConditionNotMetError("Retry condition not met: "+message)}delay=void 0;if(typeof retry.delay==="number"){delay=retry.delay}else{delay=retry.delay(retry.count)}return[4,new Promise(function(resolve){return setTimeout(resolve,delay)})];case 3:_state.sent();return[3,4];case 4:return[2]}})};options=_arguments.length>1&&_arguments[1]!==void 0?_arguments[1]:{};if(urlPrefix){if(typeof input==="string"){input="".concat(urlPrefix).concat(input)}else{throw new UrlPrefixNotSupportedError("urlPrefix is only supported for string inputs")}}optionsCopy=_object_spread({},options);if(optionsCopy===null||optionsCopy===void 0?void 0:optionsCopy.json){;;(_method=(_optionsCopy=optionsCopy).method)!==null&&_method!==void 0?_method:_optionsCopy.method="POST";optionsCopy.body=JSON.stringify(optionsCopy.json);delete optionsCopy.json;(_headers=(_optionsCopy1=optionsCopy).headers)!==null&&_headers!==void 0?_headers:_optionsCopy1.headers={};optionsCopy.headers=_object_spread({"Content-Type":"application/json"},optionsCopy.headers)}retry={count:count,delay:delay,on:DEFAULT_RETRY_ON};if(optionsCopy.retry===false){retry.count=1}else if(typeof optionsCopy.retry==="number"){retry.count=optionsCopy.retry}else if(_type_of(optionsCopy.retry)==="object"){;retry.count=(_optionsCopy_retry_count=optionsCopy.retry.count)!==null&&_optionsCopy_retry_count!==void 0?_optionsCopy_retry_count:DEFAULT_RETRY_COUNT;retry.delay=(_optionsCopy_retry_delay=optionsCopy.retry.delay)!==null&&_optionsCopy_retry_delay!==void 0?_optionsCopy_retry_delay:DEFAULT_RETRY_DELAY;retry.on=(_optionsCopy_retry_on=optionsCopy.retry.on)!==null&&_optionsCopy_retry_on!==void 0?_optionsCopy_retry_on:DEFAULT_RETRY_ON}isNewResponse=false;_state.label=1;case 1:if(!true)return[3,3];return[5,_ts_values(_loop())];case 2:_ret=_state.sent();if(_ret==="break")return[3,3];return[3,1];case 3:return[4,response.text()];case 4:textResponse=_state.sent();responseCopy=_object_spread_props(_object_spread({},response),{json:function(){return null},text:function(){return textResponse}});if(forceParseJson||((_response_headers_get=response.headers.get("Content-Type"))===null||_response_headers_get===void 0?void 0:_response_headers_get.includes("application/json"))){jsonResponse=JSON.parse(textResponse);responseCopy.json=function(){return jsonResponse}}return[2,responseCopy]}})});return function fetchWithGoodies(input){return _ref.apply(this,arguments)}}();Object.assign(fetchWithGoodies,{get:function(input){var options=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return fetchWithGoodies(input,_object_spread_props(_object_spread({},options),{method:"GET",body:undefined}))},post:function(input){var options=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return fetchWithGoodies(input,_object_spread_props(_object_spread({},options),{method:"POST"}))},head:function(input){var options=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return fetchWithGoodies(input,_object_spread_props(_object_spread({},options),{method:"HEAD",body:undefined}))},put:function(input){var options=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return fetchWithGoodies(input,_object_spread_props(_object_spread({},options),{method:"PUT"}))},delete:function(input){var options=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return fetchWithGoodies(input,_object_spread_props(_object_spread({},options),{method:"DELETE"}))},connect:function(input){var options=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return fetchWithGoodies(input,_object_spread_props(_object_spread({},options),{method:"CONNECT",body:undefined}))},options:function(input){var options=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return fetchWithGoodies(input,_object_spread_props(_object_spread({},options),{method:"OPTIONS",body:undefined}))},trace:function(input){var options=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return fetchWithGoodies(input,_object_spread_props(_object_spread({},options),{method:"TRACE",body:undefined}))},patch:function(input){var options=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return fetchWithGoodies(input,_object_spread_props(_object_spread({},options),{method:"PATCH",body:undefined}))}});return fetchWithGoodies};